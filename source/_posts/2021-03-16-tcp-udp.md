---
layout: post
title:  "TCP vs UDP"
date:   2021-03-16 00:0054 +0900
categories: java
---

### TCP (Transfer Controler Protocol)

### UDP (User Datagram Protocol)

### 전송계층 - 엔드 포인트간에 신뢰성있는 데이터 전송을 담당하는 계층.

신뢰성 - 데이터를 순차적, 안정적인 전달.

전송 - 포트 번호에 해당하는 프로세스에 데이터를 전달.
포트 번호에 맞는 프로세스를 찾아준다는 것. 이게 전송계층이 해주는 일이였구나.

송신자가 보낸 패킷이 순서 없이 무작위로 보냈다면 이걸 순서대로 정리해주는 것이 전송 계층.

네트워크가 바빠서 혼잡문제가 발생해서 패킷이 유실될 수도 있다.

### TCP 
이러한 신뢰성을 보장하는 전송계층의 프로토콜이 TCP (Transmission Control Protocol)

TCP 의 가장 큰 특징은 가상회선을 연결하고 끊는다는 점.

어플리케이션 레이어에서 보내고 싶어하는 데이터가 있다고 하자. 이를 보내기 위해 전송계층이 받으면. 필요한 크기 만큼으로 이 데이터들을 자르고
TCP 송 수신을 위한 헤더 정보를 그 잘린 데이터 앞에 추가한다.

이걸 세그먼트라고 함. (TCP Header + data)

TCP Header 는 총 32비트로 이뤄져 있는데. 여기서 8번째부터 16번째까지 총 9개에 해당하는 비트가 TCP 연결 제어 및 데이터 관리를 한다.

여기 비트 안에 ACK, SYN, FIN 이런 플래그들이 들어있음.

ACK : 수신자가 송신자에게 보내는 플래그.

SYN : 커넥션을 연결할 때 플래그

FIN : 커넥션 연결을 끊을 때 쓰는 플래그

TCP 3-way handshake.

커넥션을 수립하는 과정.

1단계
Client 가 SYN 비트를 1로 설정하고 Server 에게 패킷을 송신. (커넥션 연결 하려고 한다는 의미를 가짐)


2단계
Server 가 SYN + ACK 비트를 1로 설정하고 Client 에게 패킷을 송신 (커넥션을 연결하려고 하며, 송신자에게 이전 패킷을 수신했다는 걸 알려줌)

3단계
Client 가 ACK 비트를 1로 하여 Server 에게 송신.
(서버에게 수신하였음을 알리기 위해 송신)

최종적으로 가상회선이 구축되면 둘다 모두 established 상태가 된다.

TCP 데이터 전송 방식.

Client가 패킷을 송신. ->

Server에서 ACK 송신.

만약 정상적으로 수신하지 못했다면.
즉 Client가 ACK를 수신하지 못한다면. 클라이언트가 기다리다가 안오면 재전송.

 
 TCP 4 way-handshake

가상회선 해지하는 단계.

1. 데이터 전부를 송신한 Client가 FIN 플래그를 1로 두고 송신. TIME_WAIT 상태로 바뀜.

2. Server가 ACK 송신. 알겠다라는 의미. 서버 측에서 받은 데이터 마무리 작업이 아직 안 끝날 수도 있기 때문에. Client 가 ACK를 받아도 기다린다. FIN 신호가 와야 진짜로 끝나는 거임.

3. Server의 작업이 완료되면 FIN 신로를 보냄.

4. Client가 FIN 신호를 받으면 받았다는 의미로 ACK 
를 Server 한테 보내고 CLOSED 상태로 변경. 끝임.

TCP 문제점.
속도, 재전송 이슈.

### UDP (User Datagram Protocol)

세그먼트가 TCP 와 동일하게 UDP Header 가 붙는다.

이건 근데 전송계층의 특성은. 아니고 OSI 의 특징이지.
레이어가 내려갈수록 헤더가 추가되지.

