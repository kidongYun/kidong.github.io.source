---
layout: post
title:  "도커 강좌"
date:   2021-02-02 00:0054 +0900
categories: docker
---

클라우드의 특징은 AWS, MS Azure, GCP IBM Cloud 와 같은 다양한 벤더가 있음.
이 벤더들은 다양한 플랫폼으로 구현되어있을 꺼임. 즉 환경이 다름.

내가 만든 어플리케이션이 이런 다양한 환경에서 독립적으로 동작시키기 위해서. 도커를 사용함.

어떤 환경에서도 어플리케이션이 동작하게 만들어면 어떻게 해야하나. 

1. 어플리케이션이 동작하는 환경까지도 담아야한다. 그게 이미지라고 하네.
단순히 깃헙에서 소스코드를 클론하는 것은. 환경은 가져오는게 아니다. 우분투에서도 돌릴수 있고, 윈도우에서 돌리던 자유이다.

내가 사용하는 맥북에서는 잘 동작하는 어플리케이션을 만들었다.
프로모션에 배포했는데 이상하다.
우리 회사에서 사용하는 윈도우 서버에서는 동작이 안된다.
그이유는 환경이 다르기 때문이다.

### 도커 이미지 만들기.

도커 이미지를 만드는 행위는 빌드한다라고 표현함.

```
docker build 
```

dockerfile -> 이미지를 어떻게 빌드할지 작업 지시서가 필요함. 이 지시서가 dockerfile.
결국 다양한 플랫폼들 위에서 독립된 이미지를 구현하는 것인데. 이 도커를 빌드할 때에는 
결국 플랫폼 위에서 동작하기 때문에 어떤 컨테이너를 만들지에 대한 것은 설정이 필요함.

이미지(설계도)를 만들어서 컨테이너를 구현한다.

작업지시서(dockerfile) -> 설계도(이미지) -> 구현체(컨테이너)

여러가지 OS에서 어떤 명령어를 실행할 것인지, 등의 커스터마이징을 dockerfile 안에 녹여낼 수 있음
또 어떤 파일을 컨테이너 안에 가져갈 것인지도 정의 가능. 여기서는 name.txt 파일을 가져가서 컨테이너를 구현하도록 해야
나의 이름을 반환하는 이미지를 만들 수 있음.

명령어를 호출했는데 그 명령어에 해당하는 파일이 없는 경우는 어떻게 될까? 오류가 남. 별거 없음.

dockerfile
1. OS 지정
2. 명령어 지정
3. 이미지화 시킬 파일을 지정

호스트 PC와 컨테이너는 독립된 공간으로 이해해야함

```
FROM centos:7 // CENTOS 위에서 동작하게 함. FROM음 이미지를 불러오는 키워드임
              // centos:7 도 이미지 이름이고 : 뒤는 버전임 태그라고함

WORKDIR /app        // 현재 디렉토리를 지정할 수 있음 /app 으로 지정함.              

COPY name.txt .     // 호스트에 있는 첫번째 인자의 파일은 두번째 인자에 카피함
                    // 컨테이너에서 . 은 컨테이너의 내부 디렉토리 중 루트 디렉토리가 기본인데
                    // WORDIR 명령어로 변경이 가능함.

CMD cat name.txt    // 쉘 명령어들을 컨테이너에서 사용하려면 CMD 를 넣어야함                                
```

Dockerfile -> Image -> Container;

centos:7 을 FROM 으로 불러왔기 떄문에 컨테이너의 기반에 이 OS가 깔림. 
그리고 name.txt 파일이 그 위에 복사가 됨

```
docker build -t kidong/say-my-name:1.0 .
```

위 명령어를 쳐서 도커 이미지를 빌드한다.