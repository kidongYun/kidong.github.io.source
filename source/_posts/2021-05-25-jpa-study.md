---
layout: post
title:  "JPA 공부"
date:   2021-05-25 00:0054 +0900
categories: java
---

## JPA 배경

### 1. 영속성이란?

영속화는 단순하게 설명하면 애플리케이션의 데이터가 애플리케이션의 프로세스보다 더 오래 지속하게끔 하려는 것을 말한다. 이를 위해서 애플리케이션에서 사용되는 메모리 공간이 아닌 제 3의 메모리 공간에
데이터를 저장해야한다. 이 공간들은 대표적으로 MySQL, Postgresql, Oracle 등의 관계형 데이터베이스, MongoDB와 같은 NoSQL, 주로 캐시 목적으로 사용되는 Redis에 해당한다.
자바는 위와 같은 제 3의 공간에 데이터 영속화를 위해 제공하는 라이브러리가 있는데 이 라이브러리의 이름은 JDBC 이다.

### 2. JDBC

관계형 데이터베이스와 연동하기 위해서 자바에서 제공하는 표준 라이브러리. 자바 개발자들과 각 영속화 드라이버들 간의 통신을 위한 규격이라고 이해하면 된다. 
이 JDBC 라이브러리와 각 데이터베이스에 해당하는 드라이버들을 의존성으로 추가하면 각 데이터베이스와 자바를 연동시킬 수 있다.

### 3. SQP Mapper, JDBC 라이브러리가 가지는 문제점.

1. Domain - Relation 사이에 매핑하는 것 자체가 많은 시간이 소비된다.

2. 자바는 객체지향 언어이지만. SQL로 인해서 객체지향적인 코드를 작성하기 어렵다.

3. ..

-> 이를 개선하기 위해서 ORM이 나타났다.

### 4. ORM (Object-Relation Mapping) 등장

ORM은 애플리케이션의 클래스와 SQL 데이터베이스 테이블 사이의 매핑 정보를 기술한 메타데이터를 사용하여, 자바 애플리케이션의 객체를 SQL 데이터베이스의 테이블에 자동으로 깔끔하게 영속화 해주는 기술.

매핑정보를 기술한 메타데이터 -> 보통 자바의 어노테이션을 활용해서 기술하며, 이걸 잘 이해하고 사용하는 것이 중요하다.

ORM도 JDBC를 내부적으로 사용하며, JDBC를 보다 자바스럽게 사용할수 있도록 감싼 라이브러리라고 생각하면 된다.

매핑을 하기 위한 코드를 작성하지 않아도 되기 때문에 생산성이 증가되며, 작성되는 코드가 적어지기 떄문에 유지보수도 더 좋아진다.

성능 같은 경우는. JPA는 Persistant Context 영역에서 데이터를 캐싱하기 때문에 특정 케이스에 대해서는 성능이 더 좋을 수 있다.

그리고 또하나 중요한 ORM의 특징은 ORM 자체 내에서 각 데이터베이스 벤더에 대한 쿼리로 변경하기 때문에 개발자는 특정 벤더에 종속된 쿼리를 작성하지 않아도 된다. 즉 벤더에 독립적인 애플리케이션을 만들 수 있다.

### 5. ORM의 Object, Relation 차이를 메꾸려는 노력

1. 객체는 커스텀 객체타임을 새롭게 만들어서 정의할수 있지만. 릴레이션은 쉽지 않다.

2. 객체의 동일하다의 개념과, 릴레이션의 동일하다의 개념도 다르다.
자바에서 객체의 동일하다는 equals() 함수와, hashcode() 함수를 오버라이딩해서 정의하지만. 릴레이션은 단순히 PK 값으로만 대조가 가능하다.

3. 방향성에 대한 문제.
객체가 다른 객체를 의존한다면. 이 말은 방향성이 생긴다. 객체에서의 관계는 기본적으로 방향성이 분명히 드러난다.
릴레이션은 FK를 활용해서 두 릴레이션에 대한 정보를 조회가 가능하기 때문에 사실상 방향성이 없다.
그리고 데이터베이스에서는 N:N 관계를 N:1-1:N 형태로 정규화 하여 표현하기 때문에 N:N도 표현할 수 없다.

4. 중첩 참조에 따른 성능 문제.
객체는 특정 객체가 가진 특정 객체가 가진 특정 객체가 가진 특정 객체에 접근하는 방법이 심플함.
그러나 릴레이션에서는 위와 같은 구조를 구현하려면 모두 조인을 해야함. 즉 한번 한번 중첩될수록 실제 성능에 큰 이슈가 생김.

5. N+1 문제. -> Lazy Loading 때문에 발생.


## JPA 기본

### 1. JPA, Hibernate, Spring Data JPA 구분

JPA 는 인터페이스, 명세, 규격, 규약이며 Hibernate는 이 JPA의 규격을 따라 만든 실제 구현체, Spring Data JPA는 이 JPA를 보다 쉽게 사용하기 위해서 Spring Framework 에서 제공하는 하나의 모듈.