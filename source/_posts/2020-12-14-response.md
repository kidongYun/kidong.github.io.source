---
layout: post
title:  "API 응답 객체에 대한 사색"
date:   2020-12-14 11:38:54 +0900
categories: contemplation
---

API 개발을 처음 하게되었을 때에 가장 먼저 눈에 들어오는 것은 일반적으로 데이터다. 클라이언트에서 어떤 데이터를 요구하는지, 서버에서는 클라이언트의 요구를 합리적으로 응답해주기 위해 어떤 구조로 데이터를 내려줘야 하는지를 고민한다.
여기에서 나누고자 하는 생각은 데이터를 어떤 구조로 그려나가는 것이 좋을까에 대한 이야기는 아니고, 응답객체라면 필연적으로 고려되어야 하는 에러코드, 에러상태 등을 어떻게 잡는 것이 좋을까에 대한 것을 다룬다. 이 글은 저자의 주관적인 글임으로 맹목적인 신뢰는 지양해주시고, 잘못된 부분에 대한 지적은 댓글로 작성해주시길 바란다.

### 관습적인 Response 객체

```json

{
    "errorCode": 0,
    "errorDesc": "정상입니다",
    ...
}

{
    "errorNo": 1003,
    "errorDescription": "카드번호 불일치 오류",
    ...
}

{
    "status": 1003,
    "description": "카드번호 불일치 오류",
    ...
}


```

### 통일된 Response 응답 객체

응답 객체의 구조에 대해서 한번 생각해보자. 보통 특정 비지니스에 맞춰진 Response 구조를 생각하고 소스를 구현하기 시작한다. 여기서 만들어진 Response 의 구조를 다시 한번 짚어보자. 아마 필연적으로 대부분의 Response 객체들은 errorCode, errorDesc 와 같은 필드가 들어가게 된다. 어떤 비지니스를 위한 데이터를 떠나서 우선적으로 통신이 정상적인지 확인해야하기 때문이다. 그렇다면 Response 객체를 항상 다른 비즈니스에 맞춰 새로 만드는 것 말고, 적어도 errorCode, errorDesc 필드는 통일시키는게 어떨까?

```java

class Response {
    private int errorCode;
    private String errorDesc;
    private Object data;
}

```

내가 처음에 자주 접했던 API 응답 구조는 보통 위와 같은 구조였다. 에러코드와 에러설명을 위한 두 값이 필연적으로 존재하고, 나머지는 각 API에 맞는 데이터 값들이 나열된다. 이 에러코드와, 에러설명은 각 API, 프로젝트마다 기준이 다 달랐고, 클라이언트의 입장에서는 이 각기 다른 에러코드, 에러설명 값들을 대한 설명을 서비스 제공자에게 문서로 제공 받고 이해했다. 여기서 문제점 중 첫번째는 API 문서가 잘 관리되는 것은 현실적으로 쉽지는 않다. 물론 Swagger 등의 API 문서화를 자동화 해주는 오픈소스들이 존재하지만 여기서는 보다 근본적인 문제점을 이야기한다. 두번째는 에러코드의 기준을 클라이언트는 이해할 수 없다는 점이다. 위의 예시에서 '1003'이라는 에러코드는 API 제공자가 임의로 정해둔 룰이며 클라이언트는 그저 받아드려야 할 뿐이다. 세번째는 모든 API 제공자의 에러코드 기준이 다르다는 것이다. 어디는 errorCode가 '0' 일때 정상으로 볼 수도 있으며, 어떤 곳은 '1' 일때 정상으로 볼 수도 있다.

```

관습적인 Response 객체의 문제
    1. 에러코드에 대한 문서화 관리가 쉽지 않다.
    2. 에러코드는 API 제공자가 임의로 정한것으로 클라이언트는 그냥 받아들여야 한다.
    3. 에러코드를 세우는 기준이 존재하지 않는다.

```

각 비즈니스에 필요한 데이터 정보들은 data 필드에 넣어주면 되고, 통신 자체의 이상 유무는 통일된 필드인 errorCode, errorDesc 를 활용하여 검증이 가능해진다.

### HTTP STATUS 를 활용한 응답객체

API 통신이 여러가지 형태로 존재할 수 있지만, 웹어플리케이션 시장에서는 HTTP 프로토콜을 활용하는게 대부분이다. 그렇다면 이미 표준으로 지정되어 있는 HTTP STATUS 코드를 기반으로 errorCode 값을 만들자. 그렇다면 클라이언트들도 받아들여지기 쉬워질 것이다.

```json
{
    "errorCode": 200,
    "errorDesc": "OK",
    ...
}

{
    "errorCode": 500,
    "errorDesc": "INTERNAL_SERVER_ERROR",
    ...
}

```


1. 개별적 Response 응답 객체

2. 통일된 Response 응답 객체

3. 제네릭 사용

4. ResponseEntity.

5. ResponseEntity ErrorCode 받는법

6. body로 통일
